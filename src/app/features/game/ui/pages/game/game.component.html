<app-main-layout [title]="title">
  <div class="my-8 min-h-[50vh] flex flex-col gap-8">
    <div class="game-wrap {{isFullWidthMode ? 'full-width' : ''}} {{gameStatus === 'ended' ? 'game-ended' : ''}}">
      @if(!isLoading) {
      <div>
        <app-game-area [isFullWidthMode]="isFullWidthMode" />
        <div
          class="absolute z-[110] {{isFullWidthMode ? 'left-4 top-[calc(100vh_-_4rem)]' : 'left-0 bottom-0'}}  flex flex-row gap-4">
          <app-tooltip content="Inventory" align="left" position="top">
            <app-icon-button size="md" label="Open Inventory" icon="backpack" (onButtonClick)="handleInventoryClick()"
              [showDot]="showInventoryDot" />
          </app-tooltip>
        </div>
        <div
          class="absolute z-[110] {{isFullWidthMode ? 'right-4 top-[calc(100vh_-_4rem)]' : 'right-0 bottom-0'}}  flex flex-row gap-2">
          <app-tooltip content="Goals for this level" position="top">
            <app-icon-button label="Goals for this level" size="sm" icon="info" (onButtonClick)="handleInfoClick()" />
          </app-tooltip>
          <app-tooltip content="How to Play Teeny Quests" position="top">
            <app-icon-button label="How to Play Teeny Quests" size="sm" icon="help"
              (onButtonClick)="handleHelpClick()" />
          </app-tooltip>
          <app-tooltip content="Reset Progress" position="top">
            <app-icon-button label="Reset Progress" size="sm" icon="reset" (onButtonClick)="handleResetProgress()" />
          </app-tooltip>
          <div class="hidden sm:block">
            <app-tooltip content="Full Width" align="right" position="top">
              <app-icon-button label="{{isFullWidthMode ? 'Collapse' : 'Expand'}}" size="sm"
                icon="{{ isFullWidthMode ? 'collapse' : 'expand'}}" (onButtonClick)="handleToggleFullWidth()" />
            </app-tooltip>
          </div>
        </div>
        <div class="absolute z-[110] top-0 {{isFullWidthMode ? 'left-4' : 'left-0'}} flex flex-col gap-0 items-start">
          <div class="text-sm">
            SCORE
          </div>
          <div class="text-3xl lg:text-6xl gradient-text font-bold font-headline leading-none">
            {{score.toLocaleString()}}
          </div>
        </div>
        <div class="absolute z-[110] top-0 {{isFullWidthMode ? 'right-4' : 'right-0'}} flex flex-col gap-0 items-start">
          <div class="text-sm w-full text-right">
            TURNS
          </div>
          <div class="text-3xl lg:text-6xl gradient-text font-bold font-headline leading-none w-full text-right">
            {{numTurns.toLocaleString()}}
          </div>
        </div>
      </div>
      }

      <!-- Modal: Conversation -->
      @if(gameModalStatus === 'inventory') {
      <app-modal-inventory />
      } @if(['intro', 'help'].includes(gameModalStatus)) {
      <app-modal-page [isLoading]="isLoading" [title]="title" [gameModalStatus]="gameModalStatus"
        [levelGoals]="levelGoals" (onConfirm)="handlePageModalConfirm()" (onClose)="handlePageModalConfirm()" />
      } @if(gameModalStatus === 'loading') {
      <app-loader-animation [showBg]="true" size="sm" [isFixed]="true" />
      }
    </div>
  </div>
  @if(gameStatus === 'ended') {
  <app-game-end-message (handleGameEndConfirmClick)="handleGameEndClick()" />
  }
</app-main-layout>