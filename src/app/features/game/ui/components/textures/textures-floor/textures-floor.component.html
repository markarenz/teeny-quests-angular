<svg [attr.viewBox]="isFlat ? '0 0 100 100' : '0 0 100 50'" version="1.1" xmlns="http://www.w3.org/2000/svg"
  xmlns:svg="http://www.w3.org/2000/svg"
  [attr.style]="'position: absolute; ' + (floorDefinitions[this.floorType].tileType === 'single' && isFlat ? 'top: -10%; left: -75%; width: 250%' : 'top: 0; left: 0; width: 100%')">
  <defs>
    @if(floorType === 'dirt') {
    <pattern [id]="'texture_floor_dirt_' + (isFlat ? 'flat' : 'floor')" x="0" y="0" width="1"
      [attr.height]="isFlat ? '0.5' : '1'">
      <rect x="0" y="0" width="100" height="100" fill="#5f4126" />
      <ellipse cx="30" cy="18" rx="4" ry="2" fill="#543109" />
      <ellipse cx="75" cy="30" rx="4" ry="2" fill="#543109" />

      <circle cx="43" cy="40" r="2" fill="#7b5a36" />
      <circle cx="60" cy="20" r="2" fill="#543109" />
      <circle cx="50" cy="7" r="1" fill="#7b5a36" />
      <circle cx="56" cy="37" r="1" fill="#7b5a36" />
      <circle cx="85" cy="22" r="1" fill="#7b5a36" />
      <circle cx="10" cy="26" r="1" fill="#7b5a36" />
    </pattern>
    } @else if(floorType === 'water') {
    <pattern [id]="'texture_floor_water_' + (isFlat ? 'flat' : 'floor')" x="0" y="0" width="1"
      [attr.height]="isFlat ? '0.5' : '1'">
      <rect x="0" y="0" width="100" height="100" fill="#4444bb" />
      <path
        d="m 8.1360044,25.285197 c 0,0 2.9787586,-4.27515 9.2672496,-4.446156 6.288489,-0.171006 5.29557,6.84024 12.41149,6.84024 7.115921,0 9.432732,-4.788169 9.432732,-4.788169"
        fill="none" stroke="#6666cc" strokeWidth="2" />
      <path
        d="m 8.1360044,25.285197 c 0,0 2.9787586,-4.27515 9.2672496,-4.446156 6.288489,-0.171006 5.29557,6.84024 12.41149,6.84024 7.115921,0 9.432732,-4.788169 9.432732,-4.788169"
        fill="none" stroke="#6666cc" strokeWidth="2" transform="translate(50, 0)" />
    </pattern>
    } @else if(floorType === 'stone-dark') {
    <pattern [id]="'texture_floor_stone-dark_' + (isFlat ? 'flat' : 'floor')" x="0" y="0"
      [attr.width]="isFlat ? '100' : '1'" [attr.height]="isFlat ? '100' : '1'"
      [attr.patternUnits]="isFlat ? 'userSpaceOnUse' : 'objectBoundingBox'">
      <g class="stone-dark-group">
        <path class="border" d="M 50.000003,0 100,25 50.000003,50 0,25 Z" />
        <path class="bg" d="M 50.000003,0.5 99,25 50.000003,49.5 1,25 Z" />
        <path class="stone-shadow"
          d="m 52.500001,19.75 10,5 c 1.385,0.6925 1.385,1.807501 0,2.500001 l -10,5 c -1.385,0.6925 -3.615,0.6925 -5,0 l -10,-5 c -1.385,-0.6925 -1.385,-1.807501 0,-2.500001 l 10,-5 c 1.385,-0.6925 3.615,-0.6925 5,0 z" />
        <path class="stone-top"
          d="m 20,17.5 h 10 c 1.385,0 2.5,1.115 2.5,2.5 v 10 c 0,1.385 -1.115,2.5 -2.5,2.5 H 20 c -1.385,0 -2.5,-1.115 -2.5,-2.5 V 20 c 0,-1.385 1.115,-2.5 2.5,-2.5 z"
          transform="matrix(1,0.50000001,-1,0.50000001,50.000001,0)" />
        <path class="stone-shadow"
          d="m 47.499989,47.249901 c 1.384999,0.692499 3.615213,0.692499 5.000212,0 l 4.999694,-2.499847 2.500106,-1.250053 7.499801,-3.749901 c 1.384998,-0.692499 1.384999,-1.807606 0,-2.500106 l -7.4998,-3.7499 c -1.384999,-0.692499 -3.615214,-0.692499 -5.000212,0 L 50.000095,35.999942 45.0004,33.500094 c -1.384998,-0.692499 -3.615213,-0.692499 -5.000212,0 l -7.4998,3.7499 c -1.384999,0.6925 -1.384998,1.807607 0,2.500106 z" />
        <path class="stone-top"
          d="M 44.999894,47.499906 C 46.384893,47.499906 47.5,46.384799 47.5,44.9998 V 40.000106 37.5 30.000199 c 0,-1.384998 -1.115107,-2.500106 -2.500106,-2.500106 h -7.4998 c -1.384999,0 -2.500106,1.115108 -2.500106,2.500106 v 4.999695 h -4.999695 c -1.384998,0 -2.500106,1.115107 -2.500106,2.500106 v 7.4998 c 0,1.384999 1.115108,2.500106 2.500106,2.500106 z"
          transform="matrix(1,0.50000001,-1,0.50000001,50.000001,0)" />
        <path class="stone-shadow"
          d="m 92.499777,24.750007 c 1.384999,0.692499 1.384999,1.807606 0,2.500105 l -4.999695,2.499848 -2.500105,1.250053 -7.499801,3.7499 c -1.384998,0.692499 -3.615213,0.6925 -5.000212,0 l -7.4998,-3.7499 c -1.384999,-0.692499 -1.384998,-1.807607 0,-2.500106 l 4.999695,-2.499847 -4.999695,-2.499848 c -1.384998,-0.692499 -1.384999,-1.807607 0,-2.500106 l 7.4998,-3.7499 c 1.384999,-0.6925 3.615214,-0.692499 5.000212,0 z" />
        <path class="stone-top"
          d="m 44.999894,2.5001181 c 1.384999,0 2.500106,1.1151072 2.500106,2.5001058 v 4.9996948 2.5001053 7.499801 c 0,1.384998 -1.115107,2.500106 -2.500106,2.500106 h -7.4998 c -1.384999,0 -2.500106,-1.115108 -2.500106,-2.500106 V 15.00013 h -4.999695 c -1.384998,0 -2.500106,-1.115107 -2.500106,-2.500106 V 5.0002239 c 0,-1.3849986 1.115108,-2.5001058 2.500106,-2.5001058 z"
          transform="matrix(1,0.50000001,-1,0.50000001,50.000001,0)" />
        <path class="stone-shadow"
          d="m 7.5003186,27.250053 c -1.3849986,-0.692499 -1.3849988,-1.807606 2e-7,-2.500106 l 4.9996942,-2.499847 2.500106,-1.250053 7.499801,-3.7499 c 1.384998,-0.692499 3.615213,-0.6925 5.000212,0 l 7.4998,3.7499 c 1.384999,0.692499 1.384998,1.807607 0,2.500106 l -4.999695,2.499848 4.999695,2.499847 c 1.384998,0.692499 1.384999,1.807607 0,2.500106 l -7.4998,3.7499 c -1.384999,0.6925 -3.615214,0.692499 -5.000212,0 z" />
        <path class="stone-top"
          d="m 5.0002116,47.499894 c -1.3849986,0 -2.5001058,-1.115107 -2.5001058,-2.500106 v -4.999694 -2.500106 -7.499801 c 0,-1.384998 1.1151072,-2.500106 2.5001058,-2.500106 h 7.4998004 c 1.384999,0 2.500106,1.115108 2.500106,2.500106 v 4.999695 h 4.999695 c 1.384998,0 2.500106,1.115107 2.500106,2.500106 v 7.4998 c 0,1.384999 -1.115108,2.500106 -2.500106,2.500106 z"
          transform="matrix(1,0.50000001,-1,0.50000001,50.000001,0)" />
        <path class="stone-shadow"
          d="m 52.500157,4.7501588 c -1.385002,-0.6924993 -3.615222,-0.6924993 -5.000224,0 L 42.500227,7.2500062 40.000115,8.5000591 32.500296,12.24996 c -1.385001,0.692499 -1.385002,1.807606 0,2.500106 l 7.499818,3.7499 c 1.385003,0.692499 3.615223,0.692499 5.000224,0 l 4.999707,-2.499848 4.999707,2.499848 c 1.385001,0.692499 3.615222,0.692499 5.000224,0 l 7.499818,-3.7499 c 1.385002,-0.6925 1.385001,-1.807607 0,-2.500106 z" />
        <path class="stone-top"
          d="m 5.0002116,2.5001058 c -1.3849986,0 -2.5001058,1.1151072 -2.5001058,2.5001058 v 4.9996948 2.5001056 7.499801 c 0,1.384998 1.1151072,2.500106 2.5001058,2.500106 h 7.4998004 c 1.384999,0 2.500106,-1.115108 2.500106,-2.500106 v -4.999695 h 4.999695 c 1.384998,0 2.500106,-1.115107 2.500106,-2.500106 V 5.0002116 c 0,-1.3849986 -1.115108,-2.5001058 -2.500106,-2.5001058 z"
          transform="matrix(1,0.50000001,-1,0.50000001,50.000001,0)" />
        <path class="highlight"
          d="m 52.670159,5.816902 c 0,0 -1.681631,-1.0403207 -2.670159,-1.0403207 -0.988528,0 -2.670159,1.0403207 -2.670159,1.0403207" />
        <path class="highlight"
          d="m 52.670159,21.162736 c 0,0 -1.681631,-1.040321 -2.670159,-1.040321 -0.988528,0 -2.670159,1.040321 -2.670159,1.040321" />
        <path class="highlight"
          d="m 52.670159,35.997416 c 0,0 -1.681631,1.040321 -2.670159,1.040321 -0.988528,0 -2.670159,-1.040321 -2.670159,-1.040321" />
        <path class="highlight"
          d="m 27.661146,18.863235 c 0,0 -1.681631,-1.040321 -2.670159,-1.040321 -0.988528,0 -2.670159,1.040321 -2.670159,1.040321" />
        <path class="highlight"
          d="m 77.861146,18.863235 c 0,0 -1.681631,-1.040321 -2.670159,-1.040321 -0.988528,0 -2.670159,1.040321 -2.670159,1.040321" />
      </g>
    </pattern>
    } @else if(floorType === 'parquet') {
    <pattern [id]="'texture_floor_parquet_' + (isFlat ? 'flat' : 'floor')" x="0" y="0" width="100" height="100"
      patternUnits="userSpaceOnUse">
      <g class="parquet-group">
        <path class="border" d="M 50.000003,0 100,25 50.000003,50 0,25 Z" />
        <path class="bg" d="M 50.000003,0.5 99,25 50.000003,49.5 1,25 Z" />
        <path class="board" d="M 44.708333,3.1458335 93.70833,27.645835 87.041666,30.979168 38.041663,6.4791668 Z" />
        <path class="board" d="M 34.124999,8.4375002 83.124996,32.937502 76.458332,36.270835 27.458329,11.770834 Z" />
        <path class="board" d="m 23.541665,13.729168 48.999997,24.500001 -6.666664,3.333333 -49.000003,-24.5 z" />
        <path class="board" d="m 12.958331,19.020835 48.999997,24.500001 -6.666664,3.333333 -49.0000006,-24.5 z" />
      </g>
    </pattern>
    <pattern [id]="'texture_floor_parquet_' + (isFlat ? 'flat' : 'floor') + '-flip'" x="0" y="0" width="100"
      height="100" patternUnits="userSpaceOnUse" patternTransform="scale(-1, 1)">
      <g class="parquet-group">
        <path style="fill:#666666;" d="M 50.000003,0 100,25 50.000003,50 0,25 Z" />
        <path style="fill:#9c755c;" d="M 50.000003,0.5 99,25 50.000003,49.5 1,25 Z" />
        <path style="fill:#a9846c;"
          d="M 44.708333,3.1458335 93.70833,27.645835 87.041666,30.979168 38.041663,6.4791668 Z" />
        <path style="fill:#a9846c;"
          d="M 34.124999,8.4375002 83.124996,32.937502 76.458332,36.270835 27.458329,11.770834 Z" />
        <path style="fill:#a9846c;"
          d="m 23.541665,13.729168 48.999997,24.500001 -6.666664,3.333333 -49.000003,-24.5 z" />
        <path style="fill:#a9846c;"
          d="m 12.958331,19.020835 48.999997,24.500001 -6.666664,3.333333 -49.0000006,-24.5 z" />
      </g>
    </pattern>
    } @else if(floorType === 'roof') {
    <pattern [id]="'texture_floor_roof_' + (isFlat ? 'flat' : 'floor')" x="0" y="0" [attr.width]="isFlat ? '100' : '1'"
      [attr.height]="isFlat ? '100' : '1'" [attr.patternUnits]="isFlat ? 'userSpaceOnUse' : 'objectBoundingBox'">
      <g class="roof-group">
        <path class="border" d="M 50.000003,0 100,25 50.000003,50 0,25 Z" />
        <path class="bg" d="M 50.000003,0.5 99,25 50.000003,49.5 1,25 Z" />
        <path class="roof-1" d="M 5,25 50,12.5 v 35 z" />
        <path class="roof-2" d="M 94.999999,25 50,12.5 v 35 z" />
        <path class="roof-3" d="m 50,2.5 v 10 L 5,25 Z" />
        <path class="roof-4" d="M 94.999999,25 50,2.5 v 10 z" />
      </g>
    </pattern>
    } @else if(floorType === 'spikes') {
    <pattern [id]="'texture_floor_spikes_' + (isFlat ? 'flat' : 'floor')" x="0" y="0"
      [attr.width]="isFlat ? '100' : '1'" [attr.height]="isFlat ? '100' : '1'"
      [attr.patternUnits]="isFlat ? 'userSpaceOnUse' : 'objectBoundingBox'">
      <g class="spikes-group">
        <path class="border" d="M 50.000003,0 100,25 50.000003,50 0,25 Z" />
        <path class="bg" d="M 50.000003,0.5 99,25 50.000003,49.5 1,25 Z" />
        <path class="spike"
          d="m 55.291663,3.175 -2.5,9.113515 c 0,0 0.556819,0.750201 2.5,0.776 1.943181,0.0258 2.5,-0.776 2.5,-0.776 z" />
        <path class="spike"
          d="m 65.874997,8.4666663 -2.5,9.1135157 c 0,0 0.556819,0.750201 2.5,0.776 1.943181,0.0258 2.5,-0.776 2.5,-0.776 z" />
        <path class="spike"
          d="m 76.458331,13.758333 -2.5,9.113516 c 0,0 0.556819,0.750201 2.5,0.776 1.943181,0.0258 2.5,-0.776 2.5,-0.776 z" />
        <path class="spike"
          d="m 44.708329,8.4666663 -2.5,9.1135157 c 0,0 0.556819,0.750201 2.5,0.776 1.943181,0.0258 2.5,-0.776 2.5,-0.776 z" />
        <path class="spike"
          d="m 55.291663,13.758333 -2.5,9.113516 c 0,0 0.556819,0.750201 2.5,0.776 1.943181,0.0258 2.5,-0.776 2.5,-0.776 z" />
        <path class="spike"
          d="m 65.874997,19.05 -2.5,9.113516 c 0,0 0.556819,0.750201 2.5,0.776 1.943181,0.0258 2.5,-0.776 2.5,-0.776 z" />
        <path class="spike"
          d="m 34.124995,13.758333 -2.5,9.113516 c 0,0 0.556819,0.750201 2.5,0.776 1.943181,0.0258 2.5,-0.776 2.5,-0.776 z" />
        <path class="spike"
          d="m 44.708329,19.05 -2.5,9.113516 c 0,0 0.556819,0.750201 2.5,0.776 1.943181,0.0258 2.5,-0.776 2.5,-0.776 z" />
        <path class="spike"
          d="m 55.291663,24.341667 -2.5,9.113516 c 0,0 0.556819,0.750201 2.5,0.776 1.943181,0.0258 2.5,-0.776 2.5,-0.776 z" />
        <path class="spike"
          d="m 23.541661,19.05 -2.5,9.113516 c 0,0 0.556819,0.750201 2.5,0.776 1.943181,0.0258 2.5,-0.776 2.5,-0.776 z" />
        <path class="spike"
          d="m 34.124995,24.341667 -2.5,9.113516 c 0,0 0.556819,0.750201 2.5,0.776 1.943181,0.0258 2.5,-0.776 2.5,-0.776 z" />
        <path class="spike"
          d="m 44.708329,29.633334 -2.5,9.113516 c 0,0 0.556819,0.750201 2.5,0.776 1.943181,0.0258 2.5,-0.776 2.5,-0.776 z" />
      </g>
    </pattern>
    } @else if(floorType === 'wall-top') {
    <pattern [id]="'texture_floor_wall-top_' + (isFlat ? 'flat' : 'floor')" x="0" y="0" width="1"
      [attr.height]="isFlat ? '0.25' : '1'">
      <g class="wall-top-group">
        <rect x="0" y="0" width="100" height="100" class="bg" fill="#ccc" />
        <ellipse cx="25" cy="30" rx="3" ry="1.5" class="rock" strokeWidth="1" />
        <ellipse cx="60" cy="38" rx="3" ry="1.5" class="rock" strokeWidth="1" />
        <ellipse cx="50" cy="10" rx="3" ry="1.5" class="rock" strokeWidth="1" />
        <circle cx="75" cy="20" r="1" class="rock-filled" />
        <circle cx="50" cy="26" r="1" class="rock-filled" />
        <circle cx="26" cy="22" r="1" class="rock-filled" />
      </g>
    </pattern>
    } @else if(floorType === 'tile-dark') {
    <pattern [id]="'texture_floor_tile-dark_' + (isFlat ? 'flat' : 'floor')" x="0" y="0" width="1"
      [attr.height]="isFlat ? '0.25' : '1'">
      <g class="tile-dark-group">
        <rect x="0" y="0" width="100" height="100" class="bg" />
        @if(isFlat) {
        <polygon points="0,12.5 25,0 50,12.5 25,25 0,12.5" class="poly" />
        <polygon points="50,12.5 75,0 100,12.5 75,25 50,12.5" class="poly" />
        } @else {
        <polygon points="0,25 25,12.5 50,25 25,37.5 0,25" class="poly" />
        <polygon points="50,25 75,12.5 100,25 75,37.5 50,25" class="poly" />
        }
      </g>
    </pattern>
    } @else {
    <pattern [id]="'texture_floor_default_' + (isFlat ? 'flat' : 'floor')" x="0" y="0" width="1"
      [attr.height]="isFlat ? '0.25' : '1'">
      <rect x="0" y="0" width="100" height="100" fill="#ddd" />
      @if(isFlat) {
      <polygon points="0,12.5 25,0 50,12.5 25,25 0,12.5" fill="#d1d1d1" />
      <polygon points="50,12.5 75,0 100,12.5 75,25 50,12.5" fill="#d1d1d1" />
      } @else {
      <polygon points="0,25 25,12.5 50,25 25,37.5 0,25" fill="#d1d1d1" />
      <polygon points="50,25 75,12.5 100,25 75,37.5 50,25" fill="#d1d1d1" />
      }
    </pattern>
    }
  </defs>
  <polygon (click)="handleClick()" stroke="#aaa" strokeWidth="2" class="{{ isEditorMode ? 'editor-mode' : '' }}"
    [attr.points]="
      isFlat ? '0,0 100,0 100,100 0,100' : '50,0 100,25 50,50 0,25'
    " [attr.fill]="
      'url(#texture_floor_' +
      floorType +
      '_' +
      (isFlat ? 'flat' : 'floor') + (floorDefinitions[this.floorType].flipOdds && getPositionIndexIsOdd() ? '-flip' : '') +
      ')'
    " [attr.transform]="floorDefinitions[this.floorType].flipOdds ? '' : ''" />
</svg>